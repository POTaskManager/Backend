version: "3.9"

services:
  app:
    build:
      context: .
      dockerfile: Dockerfile.dev
    container_name: backend-dev-app
    restart: unless-stopped
    environment:
      # Global database (connecting to external PostgreSQL container)
      DATABASE_URL: postgresql://postgres:changeme@db:5432/globaldb?schema=public
      
      # Project database template (for Prisma CLI only)
      PROJECT_DATABASE_URL: postgresql://postgres:changeme@db:5432/project_default?schema=public
      
      # Dynamic project database configuration
      DB_HOST: db
      DB_PORT: 5432
      DB_USER: postgres
      DB_PASSWORD: changeme
      DB_PROJECT_PREFIX: project_
      
      # OAuth & JWT
      OAUTH_ENCRYPTION_KEY: devsecretdevsecretdevsecretdev12
      JWT_SECRET: dev-jwt-secret-key-change-in-production
      JWT_REFRESH_SECRET: dev-jwt-refresh-secret-change-in-production
      
      # Server
      PORT: 4200
      NODE_ENV: development
    ports:
      - "4200:4200"
    volumes:
      - .:/app
      - /app/node_modules
    command: ["npm", "run", "start:dev"]

# Connect to external PostgreSQL container network
networks:
  default:
    name: database_default
    external: true

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model projectaccess {
  pac_accessid   String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  pac_userid     String    @db.Uuid
  pac_projectid  String    @db.Uuid
  pac_role       String?   @db.VarChar(50)
  pac_invited_at DateTime? @db.Timestamp(6)
  pac_accepted   Boolean?  @default(false)
  pac_created_at DateTime? @default(now()) @db.Timestamp(6)
  pac_role_id    String?   @db.Uuid
  updated_at     DateTime? @db.Timestamp(6)
  projects       projects  @relation(fields: [pac_projectid], references: [proj_projid], onDelete: Cascade, onUpdate: NoAction)
  roles          roles?    @relation(fields: [pac_role_id], references: [role_roleid], onUpdate: NoAction)
  users          users     @relation(fields: [pac_userid], references: [user_userid], onDelete: Cascade, onUpdate: NoAction)

  @@index([pac_projectid], map: "idx_projectaccess_project")
  @@index([pac_userid], map: "idx_projectaccess_user")
}

model projects {
  proj_projid         String                @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  proj_name           String                @db.VarChar(255)
  proj_db_namespace   String                @unique @db.VarChar(255)
  proj_created_by     String?               @db.Uuid
  proj_created_at     DateTime?             @default(now()) @db.Timestamp(6)
  proj_description    String?
  updated_at          DateTime?             @db.Timestamp(6)
  projectaccess       projectaccess[]
  projectaccess_audit projectaccess_audit[]
  users               users?                @relation(fields: [proj_created_by], references: [user_userid], onUpdate: NoAction)
}

model roles {
  role_roleid   String          @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  role_name     String          @db.VarChar(100)
  projectaccess projectaccess[]
}

model sessions {
  session_id              String                    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  user_id                 String?                   @db.Uuid
  refresh_token_hash      String?
  expires_at              DateTime?                 @db.Timestamp(6)
  last_seen_at            DateTime?                 @db.Timestamp(6)
  revoked                 Boolean?                  @default(false)
  user_agent              String?
  ip_address              String?                   @db.Inet
  created_at              DateTime?                 @default(now()) @db.Timestamp(6)
  meta                    Json?
  refresh_token_blacklist refresh_token_blacklist[]
  users                   users?                    @relation(fields: [user_id], references: [user_userid], onDelete: Cascade, onUpdate: NoAction, map: "sessions_userid_fkey")
}

model user_identities {
  identity_id      String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  user_id          String?   @db.Uuid
  provider         String    @db.VarChar(100)
  provider_user_id String    @db.VarChar(255)
  provider_email   String?   @db.Citext
  created_at       DateTime? @default(now()) @db.Timestamp(6)
  email_verified   Boolean?  @default(false)
  display_name     String?   @db.VarChar(255)
  avatar_url       String?
  users            users?    @relation(fields: [user_id], references: [user_userid], onDelete: Cascade, onUpdate: NoAction)

  @@unique([provider, provider_user_id], map: "user_identities_provider_userid_key")
}

/// This model contains an expression index which requires additional setup for migrations. Visit https://pris.ly/d/expression-indexes for more info.
model users {
  user_userid         String                @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  user_email          String                @unique @db.Citext
  user_password_hash  String                @db.VarChar(255)
  user_name           String?               @db.VarChar(100)
  user_created_at     DateTime?             @default(now()) @db.Timestamp(6)
  user_email_verified Boolean?              @default(false)
  last_login          DateTime?             @db.Timestamp(6)
  is_active           Boolean?              @default(true)
  updated_at          DateTime?             @db.Timestamp(6)
  projectaccess       projectaccess[]
  projectaccess_audit projectaccess_audit[]
  projects            projects[]
  sessions            sessions[]
  user_audit          user_audit[]
  user_identities     user_identities[]
  usersettings        usersettings[]
}

model usersettings {
  uset_settingsid            String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  uset_userid                String?  @db.Uuid
  uset_theme                 String?  @db.VarChar(50)
  uset_language              String?  @db.VarChar(10)
  uset_notifications_enabled Boolean? @default(true)
  users                      users?   @relation(fields: [uset_userid], references: [user_userid], onDelete: Cascade, onUpdate: NoAction)
}

model projectaccess_audit {
  audit_id       String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  pac_accessid   String?   @db.Uuid
  project_id     String?   @db.Uuid
  user_id        String?   @db.Uuid
  operation      String?   @db.VarChar(20)
  changed_by     String?   @db.Uuid
  changed_at     DateTime? @default(now()) @db.Timestamp(6)
  changed_fields Json?
  old            Json?
  new            Json?
  projects       projects? @relation(fields: [project_id], references: [proj_projid], onUpdate: NoAction)
  users          users?    @relation(fields: [user_id], references: [user_userid], onUpdate: NoAction)

  @@index([project_id], map: "idx_pac_audit_project")
  @@index([user_id], map: "idx_pac_audit_user")
}

model refresh_token_blacklist {
  token_hash     String    @id
  session_id     String?   @db.Uuid
  blacklisted_at DateTime? @default(now()) @db.Timestamp(6)
  expires_at     DateTime? @db.Timestamp(6)
  reason         String?
  sessions       sessions? @relation(fields: [session_id], references: [session_id], onDelete: Cascade, onUpdate: NoAction)
}

model user_audit {
  audit_id       String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  user_id        String?   @db.Uuid
  operation      String?   @db.VarChar(20)
  changed_by     String?   @db.Uuid
  changed_at     DateTime? @default(now()) @db.Timestamp(6)
  changed_fields Json?
  old            Json?
  new            Json?
  users          users?    @relation(fields: [user_id], references: [user_userid], onUpdate: NoAction)
}

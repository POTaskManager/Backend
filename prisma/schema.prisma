// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

/* ========== USERS ========== */
model Users {
  user_userId       String   @id @default(uuid())
  user_FirstName    String
  user_LastName     String
  user_Email        String   @unique
  user_PasswordHash String
  user_IsActive     Boolean  @default(true)
  user_CreationDate DateTime @default(now())
  user_LastLogin    DateTime?

  // relations
  ProjectsOwned   Projects[]        @relation("Projects_Owner")
  ProjectMembers  ProjectMembers[]
  TasksAssigned   Tasks[]           @relation("Tasks_Assigned")
  TasksCreated    Tasks[]           @relation("Tasks_Created")
  Comments        Comments[]
  Messages        Messages[]        @relation("Messages_Sent")
  Notifications   Notifications[]
  ActivityLogs    ActivityLog[]

  @@map("Users")
}

/* ========== ROLES ========== */
model Roles {
  role_roleId     String @id @default(uuid())
  role_Name       String @unique
  role_Description String?

  Members ProjectMembers[]

  @@map("Roles")
}

/* ========== PROJECTS ========== */
model Projects {
  proj_projId       String   @id @default(uuid())
  proj_Name         String
  proj_Description  String?
  proj_OwnerId      String
  proj_StartDate    DateTime?
  proj_EndDate      DateTime?
  proj_State        String
  proj_CreationDate DateTime @default(now())

  // relations
  Owner    Users    @relation("Projects_Owner", fields: [proj_OwnerId], references: [user_userId])
  Members  ProjectMembers[]
  Boards   Boards[]
  Messages Messages[]

  @@index([proj_OwnerId])
  @@map("Projects")
}

/* ========== PROJECT MEMBERS ========== */
model ProjectMembers {
  prmb_prmbId   String @id @default(uuid())
  prmb_ProjectId String
  prmb_UserId    String
  prmb_RoleId    String

  Project Projects @relation(fields: [prmb_ProjectId], references: [proj_projId])
  User    Users    @relation(fields: [prmb_UserId], references: [user_userId])
  Role    Roles    @relation(fields: [prmb_RoleId], references: [role_roleId])

  @@unique([prmb_ProjectId, prmb_UserId]) // jeden user unikatowo w projekcie
  @@index([prmb_ProjectId])
  @@index([prmb_UserId])
  @@index([prmb_RoleId])
  @@map("ProjectMembers")
}

/* ========== BOARDS ========== */
model Boards {
  board_boardId      String   @id @default(uuid())
  board_ProjectId    String
  board_Type         String
  board_Name         String
  board_CreationDate DateTime @default(now())

  Project Projects @relation(fields: [board_ProjectId], references: [proj_projId])
  Sprints Sprints[]
  Tasks   Tasks[]

  @@index([board_ProjectId])
  @@map("Boards")
}

/* ========== SPRINTS ========== */
model Sprints {
  spr_sprId    String   @id @default(uuid())
  spr_BoardId  String
  spr_Name     String
  spr_StartDate DateTime?
  spr_EndDate   DateTime?
  spr_Goal      String?
  spr_State     String

  Board Boards @relation(fields: [spr_BoardId], references: [board_boardId])
  Tasks Tasks[]

  @@index([spr_BoardId])
  @@map("Sprints")
}

/* ========== TASKS ========== */
model Tasks {
  task_taskId           String   @id @default(uuid())
  task_BoardId          String
  task_SprintId         String?
  task_AssignedTo       String?
  task_CreationBy       String
  task_CreationDate     DateTime @default(now())
  task_Title            String
  task_Description      String?
  task_State            String
  task_Priority         String
  task_ModificationDate DateTime @updatedAt
  task_DueDate          DateTime?

  Board    Boards   @relation(fields: [task_BoardId], references: [board_boardId])
  Sprint   Sprints? @relation(fields: [task_SprintId], references: [spr_sprId])
  Assignee Users?   @relation("Tasks_Assigned", fields: [task_AssignedTo], references: [user_userId])
  Creator  Users    @relation("Tasks_Created", fields: [task_CreationBy], references: [user_userId])
  Comments Comments[]

  @@index([task_BoardId])
  @@index([task_SprintId])
  @@index([task_AssignedTo])
  @@index([task_CreationBy])
  @@map("Tasks")
}


/* ========== COMMENTS ========== */
model Comments {
  com_comId        String   @id @default(uuid())
  com_TaskId       String
  com_CreationBy   String
  com_Content      String
  com_CreationDate DateTime @default(now())

  Task    Tasks @relation(fields: [com_TaskId], references: [task_taskId])
  Creator Users @relation(fields: [com_CreationBy], references: [user_userId])

  @@index([com_TaskId])
  @@index([com_CreationBy])
  @@map("Comments")
}

/* ========== MESSAGES (chat projektowy) ========== */
model Messages {
  msg_msgId       String   @id @default(uuid())
  msg_ProjectId   String
  msg_SenderId    String
  msg_Content     String
  msg_CreationDate DateTime @default(now())

  Project Projects @relation(fields: [msg_ProjectId], references: [proj_projId])
  Sender  Users    @relation("Messages_Sent", fields: [msg_SenderId], references: [user_userId])

  @@index([msg_ProjectId])
  @@index([msg_SenderId])
  @@map("Messages")
}

/* ========== NOTIFICATIONS ========== */
model Notifications {
  not_notId        String   @id @default(uuid())
  not_UserId       String
  not_Type         String
  not_Content      String
  not_IsRead       Boolean  @default(false)
  not_CreationDate DateTime @default(now())

  User Users @relation(fields: [not_UserId], references: [user_userId])

  @@index([not_UserId])
  @@map("Notifications")
}

/* ========== ACTIVITY LOG ========== */
model ActivityLog {
  actlog_actlogId    String   @id @default(uuid())
  actlog_UserId      String
  actlog_EntityType  String
  actlog_EntityId    String
  actlog_Action      String
  actlog_Description String?
  actlog_CreationDate DateTime @default(now())

  User Users @relation(fields: [actlog_UserId], references: [user_userId])

  @@index([actlog_UserId])
  @@index([actlog_EntityType, actlog_EntityId])
  @@map("ActivityLog")
}
